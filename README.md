#Personalized News Recommendation System - TomRecommenderSystem
If you have any questions about the project (introduction, operation, post-improvement, requirements, etc.), please feel free to raise them in the issue, and I will check them at any time and reply actively! Thank you!



#illustrate
The recommendation algorithms used in this recommendation system include Collaborative Filtering, Content-based Recommendation, and Hot News Recommendation:

The implementation of collaborative filtering relies on the library provided by Mahout;
Content-based similarity recommendation is independently improved on the original algorithm based on related papers.
As the name suggests, hot news recommendations are based on news that has been viewed by the most users recently.
For more information about the recommendation algorithm, please refer to the document [Introduction to the Recommendation System.pdf]

#The main libraries used (Libs):

Ansj: The content-based recommendation part is used for word segmentation, and the TFIDF algorithm is included in it.
Quartz: Recommend the settings for the system to run at a regular interval.
Mahout: Uses built-in collaborative filtering algorithms.
Jfinal: Use the built-in ActiveRecord and Db tools to map the entity classes of the database tables in the recommender system to simplify database operations.
This recommendation system needs to be used based on the [News Module], and the definition of the [News Module] here is: ** The application of regular news gathering and news display and push to users through the public platform. **Of course, this is a practical application, if you are just doing your own research or experiments, you can only use the test data.


#Preparations
1. Database cooperation
(The main purpose of this step is to illustrate the data that the recommender system requires to be interacted with. If you build a real database, you can directly run the test data in the newly created database to complete all the table creation work, and the provided test data is attached.)

Currently, the recommender system only supports interaction with MYSQL databases

The system needs to interact with five tables: users, news, newsmodules, newslogs, and recommendations.

#Users table
A table that stores basic user information. At least two fields are required: user ID (id: bigint), user preference keyword list (pref_list: json), and user last login time (latest_log_time: timestamp).

The name of the field	type	Non-null	Primary key	foreign key	Self-incrementing	Default value
id	bigint	yes	yes		yes	
pref_list	text	yes				{"moduleid1":{},"moduleid2":{},...}
latest_log_time	timestamp	yes				
News table news
A table that stores basic news information. At least three fields are required: news ID (id:bigint), news text content (content:text), and module (module_id).

The name of the field	type	Non-null	Primary key	foreign key	Self-incrementing	Default value
id	bigint	yes	yes		yes	
title	text	yes				
content	text	yes				
module_id	int	yes		yes		
NewsModules
A table that stores information about the news module. At least two fields are required: module id (id:int), module name (name:text), and crawl time/news date (news_time:timestamp).

The name of the field	type	Non-null	Primary key	foreign key	Self-incrementing	Default value
id	int	yes	yes		yes	
name	text	yes				
news_time	timestamp	yes				
Browse the record table newslogs
A table that stores news records for users to browse. At least three fields are required: Record ID (ID: Bigint), User ID (user_id: BigInt), News ID (news_id: Bigint), Browsing Time (view_time: TimeStamp), and User's Preference for News (prefer_degree[0: Browse Only, 1: Comment, 2: Favorite]).

The name of the field	type	Non-null	Primary key	foreign key	Self-incrementing	Default value
id	bigint	yes	yes		yes	
user_id	bigint	yes		yes		
news_id	bigint	yes		yes		
view_time	timestamp	yes				
prefer_degree	int	yes				
Recommendations
Stores a table of recommendation results and user feedback generated by the recommender system for users. At least five fields are required: recommendation result ID (ID: bigint), user ID (user_id: bigint), news ID (news_id: bigint), timestamp of recommendation result generation (derive_time: timestamp), user feedback (feedback: bit[0: user not viewed, 1: user viewed]), and the corresponding recommendation algorithm generated by the result (derive_ algorithm:int[0: Collaborative Filtering, 1: Content-Based Recommendations, 2: Hot News Recommendations])

The name of the field	type	Non-null	Primary key	foreign key	Self-incrementing	Default value
id	bigint	yes	yes		yes	
user_id	bigint	yes		yes		
news_id	bigint	yes		yes		
derive_time	timestamp	yes				
feedback	bit					0
derive_algorithm	int	yes				
2. Database connection configuration
In the res directory at the root of the project, modify the database configuration in dbconfig.properties.

url = jdbc:mysql://[Hardik]/[aswal]?useUnicode=true&characterEncoding=utf8
user = Hardik
password = aswal
Note that the encoding setting of the database should be UTF8MB4. (MB4 supports emoji characters)

#Quick Start
After the database configuration is complete, follow the following four steps:

1. Under the com.qianxinyao.TomNewsRecommender package, find the class Main;

2. Choose a recommendation algorithm. Set the enableCB, enableCF, and enableHR variables of boolean to indicate whether the collaborative filtering recommendation algorithm, content-based recommendation algorithm, and hot news-based recommendation algorithm are enabled in the recommendation process, respectively. If all of them are set to true, it means that all three algorithms work together to generate recommendation results for users.

3. Select the person you want to recommend. There are three types of recommended users: all users, active users (who have logged in in recently) and custom users (users specified by themselves).

4. Choose how you want the system to run. There are two types of operation modes: one-time operation and timed operation. Once the recommendation is generated, the system stops after the generation is completed, and the system needs to be restarted to generate recommendations again. Scheduled runs, on the other hand, can generate recommended results for users at regular intervals, and if the system is not forcibly stopped, the system will continue to run. (The scheduled running time is set in the paraConfig.properties file.)

Here's the sample code:

package com.qianxinyao.TomNewsRecommender;

import java.util.ArrayList;
import java.util.List;

import org.apache.log4j.Logger;

/**
 * @author bluemapleman
 * @email tomqianmaple@gmail.com
 * @github https://github.com/bluemapleman
 * @date 2016年10月20日
 * 推荐系统入口类，在此启动推荐系统。
 */
public class Main
{
    
    public static final Logger logger = Logger.getLogger(Main.class);
    
    /**
     * 推荐系统运行入口
     * @param args
     */
    public static void main(String[] args)
    {
        //选择要在推荐系统中运行的推荐算法
        boolean enableCF=true,enableCB=false,enableHR=false;
        
        List<Long> userList=new ArrayList<Long>();
        userList.add(1L);
        userList.add(2L);
        userList.add(3L);
        
        //为指定用户执行一次推荐
        new JobSetter(enableCF,enableCB,enableHR).executeInstantJobForCertainUsers(userList);
        //定时执行推荐
//      new JobSetter(enableCF,enableCB,enableHR).executeQuartzJob(forActiveUsers);
    }
}
Daily use
All kinds of parameters running on the system can be configured in the paraConfig.properties file in the src/main/res directory in the root directory. The default configuration is recommended.

If the recommendation system needs to be able to generate effective recommendations each time, as long as the [News Module] keeps a certain amount of news captured at a certain frequency and stored in the news table. (It's best to do it at the same frequency as the recommender system's scheduled recommendations, and to complete a crawl before the recommender system runs, and it is recommended to crawl the news once a day and do a recommendation generation.) ）

Note: The incoming news should be marked with module_id, for details, please refer to the code in the NewsScraper class in the database table and com.qianxinyao.TomNewsRecommender package.

Test data
Run SQL statements in the data.sql in a MySQL database to generate database structure and test data.

The test data consists of the following sections:

Users table: 7 test users
news table: 306 test news scraped from NetEase's homepage on 2017-12-12
NewsModules table: 17 test modules
newslogs: 9 browsing records used to test the effectiveness of the recommendation algorithm
To see how well the recommender system works on test data, simply execute it under the Main class:

//在测试数据上运行
new TestDataRunner().runTestData();
The expected recommendation generation results are as follows:

If the test data is filtered collaboratively, 0 recommendations will be generated.
If a content-based recommendation is made on the test data, user 1 (id=1) will recommend 4 news items (85, 87, 89, and 104) (news with duplicate titles, and the "contract" keyword in the news title matches the user's preferred keywords), 89 news (news with duplicate titles) for user 2, and 87, 85, and 100 news (the "contract" keyword in the news title matches the user's preferred keywords).
If a recommendation is made based on hot news on the test data, user 1 will recommend 103,104, 100,104 for user 2, and 100,101 for user 3, respectively, because the most viewed news is the news (100, 101, 102, 103, 104) that the three users with browsing records have seen recently.
Additional Notes
1.com.qianxinyao.TomNewsRecommender's NewsScraper class is a class used to scrape NetEase's test news, and you can also use this class to continue collecting news. By default, this class captures all news on the homepage of NetEase News at one time.

2. The effect of collaborative filtering is currently not very stable/controllable, because it uses Mahout's built-in collaborative filtering tool. Generally speaking, the more active users of the news module, the better and more obvious the collaborative filtering effect. If there is a need, I will implement a collaborative filtering algorithm that can stably generate a specified number of recommendation results in the later stage.

3. Generally, when the number of recommendations generated by collaborative filtering and content-based recommendation algorithms is insufficient, the number can be supplemented by recommendations based on hot news.

Changelog
Everyone is welcome to submit any ideas and suggestions for this recommender system!

version	date	characteristic
V1.0.0	2018/10/04	Organize README.md documentation to make it easier to understand.
V1.0.1	Under development	1. Independently implement the Java version of the TFIDF algorithm, or organize a training corpus to achieve better keyword extraction results;
2. Improve the matching degree calculation method of the content-based recommendation algorithm to make it more efficient. (If there are thousands of favorite keywords in the user's preference list, if 1,000 recent news items are matched with the user, it only takes 100ms for the background to calculate the list of recommended results, regardless of other time factors such as network transmission)
